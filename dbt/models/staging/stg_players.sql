{{ config(materialized='table') }}

with src as (
    select * from {{ source('raw','bootstrap_static') }}
)

select
    (p->>'id')::int                                                     as player_id,
    nullif(p->>'code','')::int                                           as code,
    (p->>'element_type')::int                                            as position_id,
    (p->>'team')::int                                                     as team_id,
    nullif(p->>'team_code','')::int                                       as team_code,
    p->>'web_name'                                                       as player_web_name,
    p->>'first_name'                                                     as first_name,
    p->>'second_name'                                                    as second_name,
    nullif(p->>'squad_number','')::int                                   as squad_number,
    p->>'status'                                                         as status,
    ROUND((nullif(p->>'now_cost','')::int) / 10.0, 1)                    as now_cost,
    nullif(p->>'now_cost_rank','')::int                                  as now_cost_rank,
    nullif(p->>'now_cost_rank_type','')::int                             as now_cost_rank_type,
    nullif(p->>'minutes','')::int                                        as minutes,
    nullif(p->>'starts','')::int                                         as starts,
    nullif(p->>'total_points','')::int                                   as total_points,
    nullif(p->>'points_per_game','')::numeric                            as points_per_game,
    nullif(p->>'points_per_game_rank','')::int                           as points_per_game_rank,
    nullif(p->>'points_per_game_rank_type','')::int                      as points_per_game_rank_type,
    nullif(p->>'event_points','')::int                                   as event_points,
    nullif(p->>'form','')::numeric                                       as form,
    nullif(p->>'form_rank','')::int                                      as form_rank,
    nullif(p->>'form_rank_type','')::int                                 as form_rank_type,
    (p->>'in_dreamteam')::boolean                                        as in_dreamteam,
    nullif(p->>'dreamteam_count','')::int                                as dreamteam_count,
    nullif(p->>'selected_by_percent','')::numeric                        as selected_by_percent,
    nullif(p->>'selected_rank','')::int                                  as selected_rank,
    nullif(p->>'selected_rank_type','')::int                             as selected_rank_type,
    nullif(p->>'transfers_in','')::bigint                                as transfers_in,
    nullif(p->>'transfers_in_event','')::bigint                          as transfers_in_event,
    nullif(p->>'transfers_out','')::bigint                               as transfers_out,
    nullif(p->>'transfers_out_event','')::bigint                         as transfers_out_event,
    (p->>'can_transact')::boolean                                        as can_transact,
    (p->>'can_select')::boolean                                          as can_select,
    (p->>'removed')::boolean                                             as removed,
    (p->>'special')::boolean                                             as special,
    p->>'news'                                                           as news,
    nullif(p->>'news_added','')::timestamptz                              as news_added,
    nullif(p->>'chance_of_playing_this_round','')::int                   as chance_of_playing_this_round,
    nullif(p->>'chance_of_playing_next_round','')::int                   as chance_of_playing_next_round,
    nullif(p->>'team_join_date','')::date                                as team_join_date,
    nullif(p->>'birth_date','')::date                                    as birth_date,
    nullif(p->>'region','')::int                                         as region,
    (p->>'has_temporary_code')::boolean                                  as has_temporary_code,
    p->>'opta_code'                                                      as opta_code,
    nullif(p->>'value_form','')::numeric                                 as value_form,
    nullif(p->>'value_season','')::numeric                               as value_season,
    nullif(p->>'ep_next','')::numeric                                    as ep_next,
    nullif(p->>'ep_this','')::numeric                                    as ep_this,
    nullif(p->>'expected_goals','')::numeric                             as expected_goals,
    nullif(p->>'expected_assists','')::numeric                           as expected_assists,
    nullif(p->>'expected_goal_involvements','')::numeric                 as expected_goal_involvements,
    nullif(p->>'expected_goals_conceded','')::numeric                    as expected_goals_conceded,
    nullif(p->>'expected_goals_per_90','')::numeric                      as expected_goals_per_90,
    nullif(p->>'expected_assists_per_90','')::numeric                    as expected_assists_per_90,
    nullif(p->>'expected_goal_involvements_per_90','')::numeric          as expected_goal_involvements_per_90,
    nullif(p->>'expected_goals_conceded_per_90','')::numeric             as expected_goals_conceded_per_90,
    nullif(p->>'saves_per_90','')::numeric                               as saves_per_90,
    nullif(p->>'goals_conceded_per_90','')::numeric                      as goals_conceded_per_90,
    nullif(p->>'influence','')::numeric                                  as influence,
    nullif(p->>'creativity','')::numeric                                 as creativity,
    nullif(p->>'threat','')::numeric                                     as threat,
    nullif(p->>'ict_index','')::numeric                                  as ict_index,
    nullif(p->>'influence_rank','')::int                                 as influence_rank,
    nullif(p->>'influence_rank_type','')::int                            as influence_rank_type,
    nullif(p->>'creativity_rank','')::int                                as creativity_rank,
    nullif(p->>'creativity_rank_type','')::int                           as creativity_rank_type,
    nullif(p->>'threat_rank','')::int                                     as threat_rank,
    nullif(p->>'threat_rank_type','')::int                                as threat_rank_type,
    nullif(p->>'ict_index_rank','')::int                                  as ict_index_rank,
    nullif(p->>'ict_index_rank_type','')::int                             as ict_index_rank_type,
    nullif(p->>'bonus','')::int                                           as bonus,
    nullif(p->>'bps','')::int                                             as bps,
    nullif(p->>'clearances_blocks_interceptions','')::int                 as clearances_blocks_interceptions,
    nullif(p->>'recoveries','')::int                                      as recoveries,
    nullif(p->>'tackles','')::int                                         as tackles,
    nullif(p->>'defensive_contribution','')::int                          as defensive_contribution,
    nullif(p->>'defensive_contribution_per_90','')::numeric               as defensive_contribution_per_90,
    nullif(p->>'clean_sheets','')::int                                    as clean_sheets,
    nullif(p->>'clean_sheets_per_90','')::numeric                         as clean_sheets_per_90,
    nullif(p->>'saves','')::int                                           as saves,
    nullif(p->>'goals_scored','')::int                                    as goals_scored,
    nullif(p->>'assists','')::int                                         as assists,
    nullif(p->>'goals_conceded','')::int                                  as goals_conceded,
    nullif(p->>'own_goals','')::int                                       as own_goals,
    nullif(p->>'penalties_saved','')::int                                 as penalties_saved,
    nullif(p->>'penalties_missed','')::int                                as penalties_missed,
    nullif(p->>'yellow_cards','')::int                                    as yellow_cards,
    nullif(p->>'red_cards','')::int                                       as red_cards,
    nullif(p->>'starts_per_90','')::numeric                               as starts_per_90,
    nullif(p->>'corners_and_indirect_freekicks_order','')::int            as corners_and_indirect_freekicks_order,
    p->>'corners_and_indirect_freekicks_text'                             as corners_and_indirect_freekicks_text,
    nullif(p->>'direct_freekicks_order','')::int                          as direct_freekicks_order,
    p->>'direct_freekicks_text'                                           as direct_freekicks_text,
    nullif(p->>'penalties_order','')::int                                  as penalties_order,
    p->>'penalties_text'                                                   as penalties_text
from src
join lateral jsonb_array_elements((data->'elements')) as p on true